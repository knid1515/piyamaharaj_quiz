<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>แบบทดสอบวันปิยมหาราช</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1 id="quiz-header">แบบทดสอบวันปิยมหาราช</h1>

        <form id="quiz-form"></form>
        
        <div id="results" class="results-container" style="display: none;">
             <p id="score"></p>
             <div id="answer-details"></div>
             <div id="post-quiz-action"></div>
        </div>

        <div id="certificate" class="certificate-container" style="display: none;">
            <div class="certificate-header">
                <h2>ใบเกียรติบัตร</h2>
                <h3>Certificate of Achievement</h3>
            </div>
            <div class="certificate-body">
                <p>มอบให้แด่</p>
                <h1 id="cert-name" class="cert-name"></h1>
                <p>เนื่องในโอกาสผ่านการทดสอบความรู้ "วันปิยมหาราช"</p>
                <p>ด้วยคะแนนยอดเยี่ยม</p>
                <h2 id="cert-score"></h2>
            </div>
            <div class="certificate-footer">
                <p>ให้ไว้ ณ วันที่ <span id="cert-date"></span></p>
            </div>
        </div>

    </div>

    <script>
        // --- ข้อมูลคำถามและคำตอบ ---
        // **สำคัญ:** correctAnswer ต้องเป็นข้อความเต็มของคำตอบที่ถูกต้อง
        const quizData = [
            { question: "วันปิยมหาราชตรงกับวันที่เท่าใดของทุกปี", options: ["5 ธันวาคม", "23 ตุลาคม", "13 ตุลาคม", "10 ธันวาคม"], correctAnswer: "23 ตุลาคม" },
            { question: "'พระปิยมหาราช' เป็นพระราชสมัญญานามของพระมหากษัตริย์รัชกาลใด", options: ["รัชกาลที่ 4", "รัชกาลที่ 9", "รัชกาลที่ 5", "รัชกาลที่ 6"], correctAnswer: "รัชกาลที่ 5" },
            { question: "พระราชกรณียกิจที่สำคัญที่สุดข้อหนึ่งของรัชกาลที่ 5 คืออะไร", options: ["การเลิกทาส", "การสร้างสนามบิน", "การประดิษฐ์อักษรไทย", "การเปลี่ยนชื่อประเทศ"], correctAnswer: "การเลิกทาส" },
            { question: "ข้อใดไม่ใช่พระราชกรณียกิจในสมัยรัชกาลที่ 5", options: ["การสร้างการรถไฟ", "การปฏิรูประบบราชการ", "การจัดตั้งกิจการไปรษณีย์", "การก่อตั้งธนาคารแห่งประเทศไทย"], correctAnswer: "การก่อตั้งธนาคารแห่งประเทศไทย" },
            { question: "คำว่า 'ปิยมหาราช' มีความหมายตรงกับข้อใด", options: ["พระมหากษัตริย์ผู้ยิ่งใหญ่", "พระมหากษัตริย์นักพัฒนา", "พระมหากษัตริย์ที่ทรงเป็นที่รักยิ่งของปวงชน", "พระมหากษัตริย์ผู้ทรงธรรม"], correctAnswer: "พระมหากษัตริย์ที่ทรงเป็นที่รักยิ่งของปวงชน" },
            { question: "โรงพยาบาลหลวงแห่งแรกของไทยที่สร้างขึ้นในสมัยรัชกาลที่ 5 คือโรงพยาบาลใด", options: ["โรงพยาบาลจุฬาลงกรณ์", "โรงพยาบาลศิริราช", "โรงพยาบาลรามาธิบดี", "โรงพยาบาลพระมงกุฎเกล้า"], correctAnswer: "โรงพยาบาลศิริราช" },
            { question: "รัชกาลที่ 5 ทรงเป็นพระมหากษัตริย์ไทยพระองค์แรกที่ทรงทำสิ่งใด", options: ["เสด็จประพาสยุโรป", "ทรงผนวช", "มีพระราชโอรส", "ครองราชย์ครบ 50 ปี"], correctAnswer: "เสด็จประพาสยุโรป" },
            { question: "ระบบการปกครองส่วนภูมิภาคที่เรียกว่า 'มณฑลเทศาภิบาล' เกิดขึ้นในรัชสมัยใด", options: ["รัชกาลที่ 4", "รัชกาลที่ 5", "รัชกาลที่ 6", "รัชกาลที่ 7"], correctAnswer: "รัชกาลที่ 5" },
            { question: "พระบรมราชานุสาวรีย์ที่สำคัญของรัชกาลที่ 5 คือ 'พระบรมรูปทรงม้า' ประดิษฐานอยู่ที่ใด", options: ["สนามหลวง", "อนุสาวรีย์ชัยสมรภูมิ", "ลานพระราชวังดุสิต", "วงเวียนใหญ่"], correctAnswer: "ลานพระราชวังดุสิต" },
            { question: "สิ่งใดที่ถูกนำมาใช้เป็นครั้งแรกในสมัยรัชกาลที่ 5 เพื่อพัฒนาระบบเศรษฐกิจการเงิน", options: ["บัตรเครดิต", "เงินพดด้วง", "เหรียญกษาปณ์", "ธนบัตร"], correctAnswer: "ธนบัตร" }
        ];

        // --- ฟังก์ชันสำหรับสุ่ม Array (Fisher-Yates Shuffle Algorithm) ---
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]]; // สลับตำแหน่ง
            }
        }

        // --- ส่วนหลัก: ทำงานเมื่อหน้าเว็บโหลดเสร็จ ---
        document.addEventListener('DOMContentLoaded', () => {
            const quizForm = document.getElementById('quiz-form');
            const userName = localStorage.getItem('quizUserName') || "ผู้ทำแบบทดสอบ";
            document.getElementById('quiz-header').textContent += ` (โดย ${userName})`;

            // 1. สุ่มลำดับคำถาม
            shuffleArray(quizData);

            // 2. สร้าง HTML ของแบบทดสอบ
            let quizHTML = '';
            quizData.forEach((questionData, index) => {
                quizHTML += `<div class="question"><p>${index + 1}. ${questionData.question}</p>`;
                
                // คัดลอกและสุ่มลำดับตัวเลือก
                const shuffledOptions = [...questionData.options];
                shuffleArray(shuffledOptions);
                
                quizHTML += `<div class="options">`;
                shuffledOptions.forEach(option => {
                    // ใช้ backticks (`) เพื่อสร้าง template string ที่ซับซ้อน
                    quizHTML += `
                        <div>
                            <input type="radio" name="q${index}" id="q${index}_${option}" value="${option}">
                            <label for="q${index}_${option}">${option}</label>
                        </div>
                    `;
                });
                quizHTML += `</div></div>`;
            });
            quizHTML += `<button type="submit">ส่งคำตอบ</button>`;
            quizForm.innerHTML = quizHTML;
            
            // 3. จัดการการส่งคำตอบ
            quizForm.addEventListener('submit', handleSubmit);
        });

        // --- ฟังก์ชันจัดการเมื่อส่งคำตอบ ---
        function handleSubmit(event) {
            event.preventDefault();

            let score = 0;
            let answerDetailsHTML = '<h3>เฉลยแบบทดสอบ</h3>';
            
            quizData.forEach((data, index) => {
                const formName = `q${index}`;
                const userAnswer = (event.target.elements[formName] || {}).value;

                answerDetailsHTML += `<div class="answer-review"><p><strong>${index + 1}. ${data.question}</strong></p>`;
                if (userAnswer) {
                    if (userAnswer === data.correctAnswer) {
                        score++;
                        answerDetailsHTML += `<p>คุณตอบ: <span class="correct">${userAnswer} (ถูกต้อง)</span></p>`;
                    } else {
                        answerDetailsHTML += `<p>คุณตอบ: <span class="incorrect">${userAnswer} (ผิด)</span></p>`;
                        answerDetailsHTML += `<p class="correct-answer-text">เฉลย: ${data.correctAnswer}</p>`;
                    }
                } else {
                    answerDetailsHTML += `<p class="incorrect">คุณไม่ได้ตอบข้อนี้</p>`;
                    answerDetailsHTML += `<p class="correct-answer-text">เฉลย: ${data.correctAnswer}</p>`;
                }
                answerDetailsHTML += `</div><hr>`;
            });

            // ซ่อนฟอร์มข้อสอบ
            document.getElementById('quiz-form').style.display = 'none';
            document.getElementById('quiz-header').style.display = 'none';

            // 4. ตรวจสอบคะแนนและแสดงผลตามเงื่อนไข
            if (score > 7) {
                // แสดงใบเกียรติบัตร
                const userName = localStorage.getItem('quizUserName') || "ผู้ทำแบบทดสอบ";
                const today = new Date();
                const dateString = today.toLocaleDateString('th-TH', { day: 'numeric', month: 'long', year: 'numeric' });

                document.getElementById('cert-name').textContent = userName;
                document.getElementById('cert-score').textContent = `${score} / ${quizData.length} คะแนน`;
                document.getElementById('cert-date').textContent = dateString;
                document.getElementById('certificate').style.display = 'block';

            } else {
                // แสดงผลคะแนนปกติและปุ่มลองใหม่
                const resultsContainer = document.getElementById('results');
                document.getElementById('score').textContent = `คุณได้ ${score} จาก ${quizData.length} คะแนน`;
                document.getElementById('answer-details').innerHTML = answerDetailsHTML;
                
                const retryButton = document.createElement('button');
                retryButton.textContent = 'ลองใหม่อีกครั้ง';
                retryButton.className = 'retry-button';
                retryButton.onclick = () => window.location.reload(); // โหลดหน้าใหม่เพื่อสุ่มใหม่
                document.getElementById('post-quiz-action').appendChild(retryButton);
                
                resultsContainer.style.display = 'block';
            }
        }
    </script>
</body>
</html>
